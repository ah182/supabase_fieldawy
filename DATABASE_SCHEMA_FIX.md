# ุฅุตูุงุญ ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช - Database Schema Fix

## ๐ด ุงููุดููุฉ ุงูุชู ุชู ุงูุชุดุงููุง

### ุงูุฃุฎุทุงุก ูู ูุญุฏุฉ ุงูุชุญูู:
```
PostgrestException: column products.expiry_date does not exist
PostgrestException: column products.price does not exist  
PostgrestException: column products.user_id does not exist
PostgrestException: column products.views does not exist
```

### ๐ ุงูุณุจุจ:
ูุงู ุงูููุฏ ูุญุงูู ุงููุตูู ูุฌุฏูู `products` ุจุฃุนูุฏุฉ ุบูุฑ ููุฌูุฏุฉุ ุจูููุง ุงูุจูุงูุงุช ุงููุนููุฉ ููุฌูุฏุฉ ูู ุฌุฏุงูู ุฃุฎุฑู.

## โ ุงูุญู ุงููุทุจู

### **1. ุชุญููู ุงููููู ุงูุตุญูุญ:**

#### ๐๏ธ ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ:
- `distributor_ocr_products` - ููุชุฌุงุช ุงูููุฒุนูู ูู OCR
- `distributor_surgical_tools` - ุงูุฃุฏูุงุช ุงูุฌุฑุงุญูุฉ ููููุฒุนูู
- `vet_supplies` - ุงููุณุชูุฒูุงุช ุงูุจูุทุฑูุฉ
- `offers` - ุงูุนุฑูุถ ุงููุคูุชุฉ

#### ๐ ุงูุฃุนูุฏุฉ ุงูุตุญูุญุฉ:
- `distributor_id` ุฃู `user_id` ุจุฏูุงู ูู `user_id` ูู products
- `expiration_date` ูู `distributor_ocr_products`
- `views` ููุฌูุฏ ูู `offers` ููุท

### **2. ุชุญุฏูุซ Dashboard Repository:**

#### **ูุจู ุงูุฅุตูุงุญ:**
```dart
// ูุงู ูุจุญุซ ูู ุฌุฏูู products ุบูุฑ ุงูุตุญูุญ
final productsCount = await _supabase
    .from('products')  // โ ุฎุทุฃ
    .select('id')
    .eq('user_id', userId)  // โ ุงูุนููุฏ ุบูุฑ ููุฌูุฏ
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```dart
// ุงูุขู ูุจุญุซ ูู ุงูุฌุฏุงูู ุงูุตุญูุญุฉ
final productsCount = await _supabase
    .from('distributor_ocr_products')  // โ ุตุญูุญ
    .select('id')
    .eq('distributor_id', userId)  // โ ุงูุนููุฏ ุงูุตุญูุญ
```

### **3. ุฎุฑูุทุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ:**

| ุงููุธููุฉ | ุงูุฌุฏูู ุงูุตุญูุญ | ุงูุนููุฏ ูููุณุชุฎุฏู | ุฃุนูุฏุฉ ุฅุถุงููุฉ |
|---------|----------------|-----------------|---------------|
| ุฅุฌูุงูู ุงูููุชุฌุงุช | `distributor_ocr_products` | `distributor_id` | `price`, `expiration_date` |
| ุงูุฃุฏูุงุช ุงูุฌุฑุงุญูุฉ | `distributor_surgical_tools` | `distributor_id` | `price` |
| ุงููุณุชูุฒูุงุช ุงูุจูุทุฑูุฉ | `vet_supplies` | `user_id` | `price` |
| ุงูุนุฑูุถ ุงููุดุทุฉ | `offers` | `user_id` | `views`, `expiration_date` |

## ๐๏ธ ุงููููุงุช ุงููุญุฏุซุฉ

### **1. Dashboard Repository:**
```
โ lib/features/dashboard/data/dashboard_repository.dart
```

#### **ุงูุชุญุฏูุซุงุช ุงูุฑุฆูุณูุฉ:**
- โ ุงุณุชุฎุฏุงู ุงูุฌุฏุงูู ุงูุตุญูุญุฉ
- โ ุงูุฃุนูุฏุฉ ุงูุตุญูุญุฉ ูููุณุชุฎุฏููู  
- โ Join ูุน `ocr_products` ููุญุตูู ุนูู ุฃุณูุงุก ุงูููุชุฌุงุช
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ

### **2. SQL Migration (ุงุฎุชูุงุฑู):**
```
โ supabase/migrations/fix_dashboard_schema.sql
```

#### **ุงููุญุชููุงุช:**
- โ ุฅุถุงูุฉ ุฃุนูุฏุฉ `views` ููุฌุฏุงูู ุงูููููุฏุฉ
- โ ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
- โ ุฏูุงู ูุฒูุงุฏุฉ ุงููุดุงูุฏุงุช
- โ ุฏุงูุฉ ุฅุญุตุงุฆูุงุช ุดุงููุฉ

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

### **ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ ุงูุขู:**

| ุงูุฅุญุตุงุฆูุฉ | ุงููุตุฏุฑ ุงูุฌุฏูุฏ | ุงููุตู |
|-----------|---------------|--------|
| ุฅุฌูุงูู ุงูููุชุฌุงุช | `distributor_ocr_products` + `distributor_surgical_tools` + `vet_supplies` | ุนุฏุฏ ุญูููู ูู 3 ุฌุฏุงูู |
| ุงูุนุฑูุถ ุงููุดุทุฉ | `offers` ูุน `expiration_date > now()` | ุนุฑูุถ ูู ุชูุชู ุจุนุฏ |
| ุฅุฌูุงูู ุงููุดุงูุฏุงุช | `offers.views` | ูุดุงูุฏุงุช ุงูุนุฑูุถ ุงููุนููุฉ |
| ุงูููุชุฌุงุช ุงูุฃุญุฏุซ | `distributor_ocr_products` ูุน `ocr_products.product_name` | ุฃุณูุงุก ุญููููุฉ |
| ููุชุฌุงุช ุชูุชูู ูุฑูุจุงู | `distributor_ocr_products.expiration_date` | ุชูุงุฑูุฎ ุงูุชูุงุก ุญููููุฉ |

### **ุงูููู ุงูุดูุฑู:**
- โ ุญุณุงุจ ุนูู ุฃุณุงุณ ุงูููุชุฌุงุช ุงููุถุงูุฉ ูุฐุง ุงูุดูุฑ ููุงุจู ุงูุดูุฑ ุงููุงุถู
- โ ูู ุฌุฏูู `distributor_ocr_products`

## ๐งช ุงูุงุฎุชุจุงุฑ

### **1. ุชุดุบูู ุงูุชุทุจูู:**
```bash
flutter run
```

### **2. ูุญุต Console:**
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก PostgrestException  
- โ ุงูุจูุงูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ
- โ ุงูุฅุญุตุงุฆูุงุช ุญููููุฉ

### **3. ุงุฎุชุจุงุฑ ุงููุธุงุฆู:**
- โ ููุญุฉ ุงูุชุญูู ุชุนูู
- โ ุงูุฅุญุตุงุฆูุงุช ุชุธูุฑ
- โ ุงูููุชุฌุงุช ุงูุฃุญุฏุซ ุชุธูุฑ
- โ ุงูุชูุจููุงุช ุชุนูู

## ๐ ูุตุงุฆุญ ูููุณุชูุจู

### **ุนูุฏ ุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ:**
1. **ุชุญูู ูู ุงูุฌุฏูู ุงูุตุญูุญ** ูุจู ูุชุงุจุฉ ุงูุงุณุชุนูุงูุงุช
2. **ุงุณุชุฎุฏู JOIN** ููุญุตูู ุนูู ุจูุงูุงุช ูู ุฌุฏุงูู ูุชุนุฏุฏุฉ
3. **ุงุฎุชุจุฑ ุงูุงุณุชุนูุงูุงุช** ูู Supabase SQL Editor ุฃููุงู

### **ูุชุญุณูู ุงูุฃุฏุงุก:**
1. **ุดุบู migration** ุฅุฐุง ููุช ุชุฑูุฏ ุฅุถุงูุฉ ุฃุนูุฏุฉ views ููุฌุฏุงูู ุงูุฃุฎุฑู
2. **ุงุณุชุฎุฏู ุงูููุงุฑุณ** ุงูููุชุฑุญุฉ ูู ุงูู migration
3. **ุงุนุชุจุฑ ุฅูุดุงุก views** ูุชุจุณูุท ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ

## โ ุงููุชูุฌุฉ

**ูุจู ุงูุฅุตูุงุญ:** โ ุฃุฎุทุงุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ููุญุฉ ุชุญูู ูุง ุชุนูู

**ุจุนุฏ ุงูุฅุตูุงุญ:** โ ููุญุฉ ุชุญูู ุชุนูู ุจุงููุงูู ูุน ุจูุงูุงุช ุญููููุฉ

---

## ๐ ููุฏุนู

ุฅุฐุง ุธูุฑุช ุฃุฎุทุงุก ุฃุฎุฑู:
1. ุชุญูู ูู console ููุฃุฎุทุงุก ุงูุฌุฏูุฏุฉ
2. ุฑุงุฌุน ุฃุณูุงุก ุงูุฌุฏุงูู ูุงูุฃุนูุฏุฉ ูู Supabase
3. ุงุณุชุฎุฏู SQL Editor ูุงุฎุชุจุงุฑ ุงูุงุณุชุนูุงูุงุช

**ููุญุฉ ุงูุชุญูู ุงูุขู ุชุนูู ูุน ุงูุจูุงูุงุช ุงูุญููููุฉ! ๐**