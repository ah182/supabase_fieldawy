# ุฅุตูุงุญ ุนุฏู ุธููุฑ ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูู ุตูุญุฉ Analytics ููุฃุทุจุงุก

## ุงููุดููุฉ ๐ด

ุงูุฃุทุจุงุก ุงูุฐูู ููุณ ูุฏููู ููุชุฌุงุช ูุง ูุฑูู ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูุนูููุงุช ุงูุจุญุซ ูู ุตูุญุฉ Analytics.

## ุงูุณุจุจ ๐

ุงูุณูุงุณุฉ ุงูุญุงููุฉ ูู ุฌุฏูู `search_tracking` ุชุณูุญ ููุท ูููุณุชุฎุฏููู ุจุฑุคูุฉ ุนูููุงุช ุงูุจุญุซ **ุงูุฎุงุตุฉ ุจูู ููุท**:

```sql
CREATE POLICY "Users can view own search history" ON search_tracking
    FOR SELECT USING (auth.uid() = user_id);
```

ูุฐู ุงูุณูุงุณุฉ ุชููุน ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูุฅุญุตุงุฆูุฉ ุงูุนุงูุฉ (ุงูุชุฑูุฏุงุชุ ุงูุชูุฒูุน ุงูุฌุบุฑุงูู) ูู ุฌููุน ุงููุณุชุฎุฏููู.

## ุงูุญู โ

ุชุทุจูู ุณูุงุณุฉ RLS ุฌุฏูุฏุฉ ุชุณูุญ ูุฌููุน ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ุจูุฑุงุกุฉ ุฌููุน ุจูุงูุงุช ุงูุจุญุซ ููุฃุบุฑุงุถ ุงูุฅุญุตุงุฆูุฉ.

## ุฎุทูุงุช ุงูุฅุตูุงุญ ๐

### 1. ุชุดุบูู SQL Script ูู Supabase

ุงูุชูู ุฅูู **Supabase Dashboard** โ **SQL Editor** ููู ุจุชุดุบูู ุงูููู:

```
supabase/fix_search_tracking_rls_for_analytics.sql
```

ุฃู ุงูุณุฎ ูุงูุตู ูุฐุง ุงูููุฏ:

```sql
-- ุฅุตูุงุญ Row Level Security ูุฌุฏูู search_tracking
-- ููุณูุงุญ ุจูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูุฅุญุตุงุฆูุฉ (ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูุงูุชุฑูุฏุงุช) ูุฌููุน ุงููุณุชุฎุฏููู

-- ุญุฐู ุงูุณูุงุณุฉ ุงููุฏููุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
DROP POLICY IF EXISTS "Users can view own search history" ON search_tracking;
DROP POLICY IF EXISTS "Allow authenticated users to read all search data for analytics" ON search_tracking;

-- ุณูุงุณุฉ ุฌุฏูุฏุฉ: ุงูุณูุงุญ ูุฌููุน ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ุจูุฑุงุกุฉ ุฌููุน ุจูุงูุงุช ุงูุจุญุซ
CREATE POLICY "Allow authenticated users to read all search data for analytics" ON search_tracking
    FOR SELECT 
    TO authenticated
    USING (true);  -- ุฌููุน ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ูููููู ุงููุฑุงุกุฉ

-- ุณูุงุณุฉ ููุฅุฏุฑุงุฌ: ุงููุณุชุฎุฏููู ูููููู ุฅุฏุฑุงุฌ ุนูููุงุช ุงูุจุญุซ ุงูุฎุงุตุฉ ุจูู ููุท
DROP POLICY IF EXISTS "Users can insert own searches" ON search_tracking;
CREATE POLICY "Users can insert own searches" ON search_tracking
    FOR INSERT 
    TO authenticated
    WITH CHECK (auth.uid() = user_id);

-- ุณูุงุณุฉ ููุชุญุฏูุซ: ุงููุณุชุฎุฏููู ูููููู ุชุญุฏูุซ ุนูููุงุช ุงูุจุญุซ ุงูุฎุงุตุฉ ุจูู ููุท
DROP POLICY IF EXISTS "Users can update own searches" ON search_tracking;
CREATE POLICY "Users can update own searches" ON search_tracking
    FOR UPDATE 
    TO authenticated
    USING (auth.uid() = user_id);

-- ุงูุชุฃูุฏ ูู ุชูุนูู RLS
ALTER TABLE search_tracking ENABLE ROW LEVEL SECURITY;

-- ููุญ ุงูุตูุงุญูุงุช
GRANT SELECT ON search_tracking TO authenticated;
```

### 2. ุงูุชุญูู ูู ุงูุจูุงูุงุช (ุงุฎุชูุงุฑู)

ููุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู `search_tracking`ุ ุดุบูู:

```
supabase/verify_search_tracking_data.sql
```

### 3. ุงุฎุชุจุงุฑ ุงูุชุทุจูู

1. ุณุฌูู ุงูุฏุฎูู ูุทุจูุจ ููุณ ูู ููุชุฌุงุช
2. ุงูุชุญ ุตูุญุฉ **Analytics** ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
3. ุชุญูู ูู ุธููุฑ **ุงูุชูุฒูุน ุงูุฌุบุฑุงูู** ูู ูุณู "ุงูุฃูุซุฑ ุจุญุซุงู"

## ุงููุชูุฌุฉ ุงููุชููุนุฉ โจ

- โ ุฌููุน ุงููุณุชุฎุฏููู (ุฃุทุจุงุก ูููุฒุนูู) ูููููู ุฑุคูุฉ ุงูุชุฑูุฏุงุช ูุงูุชูุฒูุน ุงูุฌุบุฑุงูู
- โ ุงูุจูุงูุงุช ุงูุฅุญุตุงุฆูุฉ ูุชุงุญุฉ ููุฌููุน (ูููุฑุงุกุฉ ููุท)
- โ ุงููุณุชุฎุฏููู ูููููู ุฅุถุงูุฉ/ุชุนุฏูู ุนูููุงุช ุงูุจุญุซ **ุงูุฎุงุตุฉ ุจูู ููุท**

## ููุงุญุธุงุช ุฃูููุฉ ๐

- **ุงููุฑุงุกุฉ**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ูููููู ูุฑุงุกุฉ ุฌููุน ุจูุงูุงุช ุงูุจุญุซ (ููุฅุญุตุงุฆูุงุช ููุท)
- **ุงููุชุงุจุฉ/ุงูุชุนุฏูู**: ุงููุณุชุฎุฏููู ูููููู ุฅุถุงูุฉ/ุชุนุฏูู ุนูููุงุช ุงูุจุญุซ ุงูุฎุงุตุฉ ุจูู ููุท
- **ุงูุญุฐู**: ุบูุฑ ูุณููุญ ูููุณุชุฎุฏููู (ูุชู ุงูุญุฐู ุชููุงุฆูุงู ุนูุฏ ุญุฐู ุงููุณุชุฎุฏู)

## ูููุงุช ุชู ุฅูุดุงุคูุง ๐

1. **ุตูุญุฉ Analytics ุงูุฌุฏูุฏุฉ**:
   - `lib/features/analytics/presentation/pages/analytics_page.dart`
   
2. **Widget ุงูุชุฑูุฏุงุช ุจุฏูู ุฒุฑ ุงููุชุงููุฌ**:
   - `lib/features/analytics/presentation/widgets/trends_analytics_no_catalog_widget.dart`
   
3. **ุชุญุฏูุซ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ**:
   - `lib/features/home/presentation/screens/menu_screen.dart`

4. **ุฅุตูุงุญ RLS**:
   - `supabase/fix_search_tracking_rls_for_analytics.sql`
   - `supabase/verify_search_tracking_data.sql`

## ุฏุนู ๐ฌ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงููุ ุชุฃูุฏ ูู:
1. ุชุดุบูู SQL script ุจูุฌุงุญ ูู Supabase
2. ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู `search_tracking` (ูููู ุงูุชุญูู ุจู `verify_search_tracking_data.sql`)
3. ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุดูู ุตุญูุญ (authenticated)
