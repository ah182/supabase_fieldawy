ملف تعليمات: خطوات بناء لوحة التحكم (Admin Dashboard)

مرحباً، هذا الملف يلخص الخطوات التي تم اتخاذها لبناء لوحة التحكم الخاصة بالويب حتى الآن، لمساعدة أي مطور يكمل العمل من بعدي.

==================================================
المرحلة الأولى: الإعداد الأولي وإنشاء الهيكل
==================================================

1.  **التأكد من دعم الويب:** تم التأكد من أن المشروع مهيأ للعمل على الويب عبر أمر `flutter doctor`.
2.  **إنشاء المجلدات:** تم إنشاء هيكل مجلدات جديد مخصص للوحة التحكم في المسار: `lib/features/admin_dashboard`.
3.  **إنشاء الشاشات الأولية:**
    *   `admin_login_screen.dart`: شاشة تسجيل دخول المدير.
    *   `admin_dashboard_screen.dart`: شاشة لوحة التحكم الرئيسية.
    *   `product_management_screen.dart`: شاشة إدارة المنتجات.

==================================================
المرحلة الثانية: نظام التوجيه (Routing)
==================================================

1.  **تحديد نظام التوجيه:** تم اكتشاف أن المشروع يستخدم نظام المسارات المدمج في `MaterialApp`.
2.  **إضافة مسارات الأدمن:** تم تعديل ملف `lib/main.dart` لإضافة المسارات التالية:
    *   `/admin/login` -> يوجه إلى `AdminLoginScreen`.
    *   `/admin/dashboard` -> يوجه إلى `AdminScaffold` (الهيكل الرئيسي للداشبورد).

==================================================
المرحلة الثالثة: بناء الواجهات الرئيسية
==================================================

1.  **الهيكل العام (`AdminScaffold`):**
    *   تم إنشاء `Widget` رئيسي في `lib/features/admin_dashboard/presentation/widgets/admin_scaffold.dart`.
    *   يحتوي هذا الـ `Widget` على قائمة تنقل جانبية (`NavigationRail`) بها روابط لأقسام "Dashboard" و "Products" و "Orders".
    *   يستخدم `IndexedStack` لعرض محتوى كل قسم بناءً على الاختيار من القائمة الجانبية.

2.  **شاشة تسجيل الدخول (`AdminLoginScreen`):**
    *   تم تصميم واجهة تسجيل دخول بسيطة تحتوي على حقول البريد الإلكتروني وكلمة المرور وزر تسجيل الدخول.
    *   **ملاحظة:** منطق التحقق من هوية المدير لم يتم ربطه بعد، حاليًا أي بيانات تقوم بإدخالها ستسمح لك بالدخول للداشبورد.

3.  **شاشة إدارة المنتجات (`ProductManagementScreen`):**
    *   تم تصميم واجهة لعرض كل المنتجات في جدول بيانات (`PaginatedDataTable`) يدعم تقسيم الصفحات.
    *   الجدول يعرض بيانات المنتج الأساسية ويحتوي على أزرار "تعديل" و "حذف" (الأزرار لا تعمل بعد).

==================================================
المرحلة الرابعة: ربط البيانات الحقيقية (Providers)
==================================================

1.  **نقل `Provider` المنتجات:**
    *   تم نقل `allDistributorProductsProvider` من `home_screen.dart` إلى `product_repository.dart` ليكون متاحًا لكل أجزاء التطبيق. هذا أصلح خطأ "Undefined name" الذي كان يظهر بشكل متكرر.

2.  **ربط كارت "Total Products":**
    *   تم تعديل `AdminDashboardScreen` ليقرأ عدد المنتجات الفعلي من `adminAllProductsProvider` ويعرضه.

3.  **ربط كارت "Total Users":**
    *   تم إضافة دالة `getTotalUsersCount()` في `UserRepository` لعدّ المستخدمين من جدول `users`.
    *   تم إنشاء `totalUsersProvider` جديد لهذا الغرض.
    *   تم تعديل `AdminDashboardScreen` ليقرأ عدد المستخدمين الفعلي ويعرضه.

4.  **حل مشكلة الكاش في الداشبورد:**
    *   تم ملاحظة أن الداشبورد كان يعرض بيانات قديمة بسبب الكاش.
    *   تم إنشاء `Provider` جديد مخصص للأدمن (`adminAllProductsProvider`) يقوم بتجاوز الكاش دائمًا لجلب بيانات حديثة، مع الحفاظ على الكاش لتطبيق المستخدمين لضمان السرعة.

==================================================
المرحلة الخامسة: إعدادات قاعدة البيانات والأمان (RLS)
==================================================

1.  **تشخيص المشكلة:** تم تشخيص سبب توقف التطبيق عن العمل عند فتح الداشبورد بأنه بسبب صلاحيات الوصول (RLS) في Supabase التي كانت تمنع قراءة البيانات.
2.  **إضافة سياسات القراءة (Policies):** تم إرشادك لإضافة سياسات تسمح بالقراءة العامة للجداول التالية:
    *   `products`
    *   `distributor_products`
    *   `users`
3.  **تحذير أمني:** تم التنبيه على أن السياسة المطبقة على جدول `users` حاليًا (`USING (true)`) هي لأغراض التطوير فقط وتعتبر غير آمنة للتطبيق النهائي، حيث أنها تكشف بيانات المستخدمين. يجب استبدالها بسياسة أكثر أمانًا بعد برمجة نظام تسجيل دخول حقيقي للمدير.

==================================================
الخطوات التالية المقترحة
==================================================

-   برمجة وظائف أزرار "التعديل" و "الحذف" في صفحة إدارة المنتجات.
-   ربط باقي كروت الإحصائيات (Pending Orders, Revenue) ببيانات حقيقية.
-   بناء نظام تسجيل دخول آمن للمدير واستبدال سياسة RLS المؤقتة.

