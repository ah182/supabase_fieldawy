# دليل توسيع نطاق البحث وجلب البيانات (Future Scaling Guide)

هذا الملف يشرح الاستراتيجية التقنية لتحويل التطبيق من التعامل مع بيانات محدودة إلى التعامل مع مئات الآلاف من المنتجات بكفاءة عالية.

## تفاصيل الخطة المستقبلية (شرح تفصيلي)

الانتقال من "البحث المحلي" (الحالي) إلى "البحث السحابي" (المستقبلي) هو خطوة طبيعية في حياة أي تطبيق ناجح.

إليك الخطة التفصيلية لما سنفعله "خطوة بخطوة" عندما يزداد حجم البيانات (مثلاً عند الوصول لأكثر من 10,000 منتج):

### 1. تغيير استراتيجية "جلب البيانات" (Pagination)
**المشكلة الحالية:** نحن نجلب "كل" المنتجات مرة واحدة.
**الحل المستقبلي:** سنطبق نظام "الصفحات" (Pagination) أو "التحميل اللانهائي" (Infinite Scroll).

*   **ماذا سنفعل؟**
    *   بدل ما نقول للسيرفر: "هات كل المنتجات"، سنقول له: "هات أول 20 منتج فقط".
    *   عندما ينزل المستخدم لأسفل الشاشة، نطلب من السيرفر: "هات الـ 20 منتج التاليين".
*   **الفائدة:** التطبيق سيفتح في ثانية واحدة حتى لو عندك مليون منتج، واستهلاك النت سيكون محدوداً جداً.

---

### 2. نقل منطق البحث إلى السيرفر (Server-Side Search)
**المشكلة الحالية:** الهاتف هو من يقوم بفلترة المنتجات (لأنه يمتلك القائمة كاملة).
**الحل المستقبلي:** السيرفر هو من سيبحث ويرسل لك النتائج فقط.

*   **الخطوة التقنية (Backend):**
    *   سننشئ دالة في قاعدة البيانات (PostgreSQL Function) تقبل "كلمة البحث".
    *   سنستخدم تقنية اسمها **Full Text Search** داخل Supabase. هذه التقنية ذكية جداً (أذكى من البحث العادي)، يمكنها فهم الأخطاء الإملائية البسيطة، أو البحث عن جزء من الكلمة بكفاءة عالية.
    *   سنقوم بإنشاء **فهرس (Index)** على عمود "اسم المنتج". الفهرس مثل "فهرس الكتاب"، يجعل قاعدة البيانات تصل للمعلومة في جزء من الثانية بدل ما تقرأ الجدول كله.

---

### 3. تعديل سلوك التطبيق (Debouncing)
هذه أهم خطوة في "واجهة المستخدم" (UI) عند الانتقال للبحث السحابي.

*   **الوضع الحالي:** البحث يتم مع كل حرف تكتبه (تكتب "P" يبحث، "a" يبحث..). هذا مسموح لأن البحث على الهاتف سريع ومجاني.
*   **الوضع المستقبلي:** لو أرسلنا طلباً للسيرفر مع كل حرف، السيرفر "هيهنّج" (Overload).
*   **الحل (Debouncing):**
    *   سنضيف مؤقت زمني (مثلاً 500 مللي ثانية).
    *   عندما يكتب المستخدم، التطبيق سينتظر.. لو المستخدم توقف عن الكتابة لمدة نصف ثانية، هنا فقط نرسل الطلب للسيرفر.
    *   هذا يقلل عدد الطلبات من 10 طلبات للكلمة الواحدة إلى طلب واحد فقط.

---

### 4. (مرحلة الوحش) محركات البحث المتخصصة
لو التطبيق أصبح ضخماً جداً (مثل أمازون أو نون)، وقاعدة البيانات العادية لم تعد كافية للسرعة المطلوبة.

*   **الحل:** نستخدم خدمة خارجية متخصصة في البحث فقط مثل **Meilisearch** أو **Algolia** أو **Typesense**.
*   **كيف تعمل؟**
    *   هذه الخدمات تأخذ نسخة من بيانات المنتجات وتضعها في "محرك بحث" فائق السرعة.
    *   عندما يبحث المستخدم، التطبيق يكلم هذا المحرك بدلاً من قاعدة البيانات.
    *   تعطيك ميزات خرافية مثل: (هل تقصد كذا؟ - ترتيب النتائج حسب الشعبية - البحث بالمرادفات).

### ملخص الجدول الزمني:

1.  **الآن (أقل من 5000 منتج):** نستخدم الطريقة الحالية (Cache + Local Search) -> أسرع وأوفر وأسهل.
2.  **المرحلة المتوسطة (5000 - 50,000 منتج):** نطبق الـ **Pagination** والبحث المباشر من الـ Database باستخدام الفهارس (Indexes).
3.  **المرحلة المتقدمة (+100,000 منتج):** نربط التطبيق بمحرك بحث متخصص (Search Engine).

لا تقلق، الكود الحالي مكتوب بطريقة نظيفة (Clean Architecture)، مما يجعل الانتقال لهذه المراحل مستقبلاً مجرد "تغيير في مصدر البيانات" دون الحاجة لهدم وبناء التطبيق من جديد.

---
## ملخص سريع للمراحل

### المرحلة الأولى: الوضع الحالي (حتى 5,000 منتج)
**الاستراتيجية:** البحث المحلي (Client-side Search) مع التخزين المؤقت (Caching).
*   **كيف يعمل؟** يتم جلب القائمة كاملة مرة واحدة وتخزينها في الكاش.
*   **المميزات:** سرعة فائقة في النتائج (Instant Search)، تقليل عدد الطلبات للسيرفر، تجربة مستخدم سلسة جداً.
*   **العيوب:** استهلاك بسيط للذاكرة في البداية، وقت تحميل أولي عند فتح التطبيق لأول مرة.

### المرحلة الثانية: التوسع المتوسط (5,000 - 50,000 منتج)
عندما يصبح حجم ملف المنتجات كبيراً ويؤثر على وقت فتح التطبيق، ننتقل إلى **البحث السحابي (Server-side Search)**.
*   **1. تطبيق نظام الصفحات (Pagination):** جلب البيانات على دفعات (مثلاً 20 منتج كل مرة).
*   **2. البحث داخل قاعدة البيانات (Database Search):** نقل منطق الفلترة إلى SQL واستخدام الفهارس (Indexes).
*   **3. تحسين واجهة المستخدم (Debouncing):** تأخير إرسال طلب البحث قليلاً لتقليل الضغط على السيرفر.

### المرحلة الثالثة: التوسع الضخم (+100,000 منتج)
عندما لا تكفي قاعدة البيانات التقليدية للبحث السريع.
*   **1. محركات البحث المتخصصة (Search Engines):** مثل Algolia أو Meilisearch.
*   **2. الميزات المتقدمة:** التصحيح التلقائي، البحث بالمرادفات، والترتيب الذكي للنتائج.

### مؤشرات الحاجة للتغيير (Signs it's time to scale)
1.  إذا تجاوز حجم البيانات المحملة عند فتح التطبيق 5 ميجابايت.
2.  إذا لاحظت "تهنيج" (Lag) بسيط في شاشة البحث عند الكتابة.
3.  إذا زاد عدد المنتجات في قاعدة البيانات عن 10,000 منتج بشكل فعلي.