# ๐ ุฏููู ุฅุนุฏุงุฏ ุฅุดุนุงุฑุงุช ุงูุชููููุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุณูุชู ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูุฌููุน ุงููุณุชุฎุฏููู ุนูุฏ:
1. **ุฅุถุงูุฉ ุทูุจ ุชูููู ุฌุฏูุฏ** - ูุญุชูู ุนูู ุงุณู ุงูููุชุฌ ูุงุณู ุตุงุญุจ ุงูุทูุจ
2. **ุฅุถุงูุฉ ุชุนููู ุฌุฏูุฏ** - ูุญุชูู ุนูู ูุญุชูู ุงูุชุนููู ูุงุณู ุงููุนูู ูุงูุชูููู

---

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1๏ธโฃ ุชุทุจูู SQL Triggers

ูู Supabase SQL Editorุ ูู ุจุชูููุฐ:

```sql
-- ูู Supabase Dashboard > SQL Editor
-- ุงูุชุญ ุงูููู: supabase/migrations/ADD_review_notifications_triggers.sql
-- ูููุฐู
```

**ุงูููู ูููู ุจู:**
- โ ุฅูุดุงุก function ูุฅุฑุณุงู webhook ุนูุฏ ุฅุถุงูุฉ ุทูุจ ุชูููู
- โ ุฅูุดุงุก function ูุฅุฑุณุงู webhook ุนูุฏ ุฅุถุงูุฉ ุชุนููู
- โ ุฅูุดุงุก triggers ุชููุงุฆูุฉ

---

### 2๏ธโฃ ุชูุนูู pg_net Extension

ูู Supabaseุ ูู ุจุชูุนูู `pg_net` extension ูุฅุฑุณุงู HTTP requests:

```sql
-- ูู Supabase Dashboard > SQL Editor
CREATE EXTENSION IF NOT EXISTS pg_net;
```

---

### 3๏ธโฃ ุชุญุฏูุซ Cloudflare Worker

ุงูููู `cloudflare-webhook/src/index.js` **ุชู ุชุญุฏูุซู** ููุฏุนู:
- โ ูุนุงูุฌุฉ `review_requests` table
- โ ูุนุงูุฌุฉ `product_reviews` table
- โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ ููุชููููุงุช

**ุฅุนุงุฏุฉ ูุดุฑ ุงูู Worker:**

```bash
cd cloudflare-webhook
npx wrangler deploy
```

---

### 4๏ธโฃ ุชุนููู Webhook URL

ุจุนุฏ ูุดุฑ ุงูู Workerุ ุงุญุตู ุนูู ุงูู URL ููู ุจุชุนูููู ูู Supabase:

```sql
-- ุงุณุชุจุฏู YOUR_WORKER_URL ุจุงูู URL ุงูุญูููู
ALTER DATABASE postgres SET app.settings.webhook_url TO 'https://your-worker.workers.dev';
```

**ููุชุญูู:**

```sql
-- ููุชุญูู ูู ุงูุฅุนุฏุงุฏ
SELECT current_setting('app.settings.webhook_url', true);
```

---

## ๐ฑ ุดูู ุงูุฅุดุนุงุฑุงุช

### ุฅุดุนุงุฑ ุทูุจ ุชูููู ุฌุฏูุฏ:
```
โญ ุทูุจ ุชูููู ุฌุฏูุฏ
ุทูุจ ุฃุญูุฏ ูุญูุฏ ุชูููู ุฏูุงุก ุจุงุฑุงุณูุชุงููู
```

### ุฅุดุนุงุฑ ุชุนููู ุฌุฏูุฏ:
```
๐ฌ ุชุนููู ุฌุฏูุฏ (5โญ)
ูุญูุฏ ุนูู: ููุชุฌ ููุชุงุฒ ููุนุงู ุฌุฏุงูุ ุฃูุตุญ ุจู
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุงุฎุชุจุงุฑ ุทูุจ ุงูุชูููู:
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุถุบุท ุนูู "ุทูุจ ุชูููู ูููุชุฌู"
3. ุงุฎุชุฑ ููุชุฌ ูุฃุฑุณู ุงูุทูุจ
4. ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู ูุฌุจ ุฃู ูุณุชูููุง ุฅุดุนุงุฑ

### ุงุฎุชุจุงุฑ ุงูุชุนููู:
1. ุงูุชุญ ุตูุญุฉ ุงูููุชุฌุงุช ุงููุทููุจ ุชูููููุง
2. ุฃุถู ุชูููู ูุน ุชุนููู
3. ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู ูุฌุจ ุฃู ูุณุชูููุง ุฅุดุนุงุฑ

---

## ๐ ุงูุชุญูู ูู ุงูุฃุฎุทุงุก

### ูู Supabase:
```sql
-- ุนุฑุถ ุขุฎุฑ ุงูู notices
SELECT * FROM pg_stat_activity WHERE state = 'active';
```

### ูู Cloudflare Worker:
1. ุงุฐูุจ ูู Cloudflare Dashboard
2. Workers & Pages > your-worker > Logs
3. ุฑุงูุจ ุงูู console logs

---

## ๐ ุงูุจูุงูุงุช ุงููุฑุณูุฉ

### ูุทูุจ ุงูุชูููู:
```json
{
  "type": "new_review_request",
  "review_request_id": "uuid",
  "product_id": "123",
  "product_type": "product"
}
```

### ููุชุนููู:
```json
{
  "type": "new_product_review",
  "review_id": "uuid",
  "review_request_id": "uuid",
  "product_id": "123",
  "product_type": "product",
  "rating": 5
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **pg_net Extension:**
   - ูุฌุจ ุชูุนููู ูู Supabase
   - ูุณุชุฎุฏู ูุฅุฑุณุงู HTTP requests ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

2. **Webhook URL:**
   - ูุฌุจ ุฃู ูููู accessible ูู Supabase
   - ุชุฃูุฏ ุฃู ุงูู CORS ููุนู ูู ุงูู Worker

3. **Firebase Service Account:**
   - ูุชููุฑ ูู Cloudflare Worker environment variables
   - ุถุฑูุฑู ูุฅุฑุณุงู FCM notifications

4. **ุงูุชุนูููุงุช ุงููุงุฑุบุฉ:**
   - ูู ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุชููููุงุช ุจุฏูู ุชุนููู
   - ููุท ุงูุชููููุงุช ุงูุชู ุชุญุชูู ุนูู ูุต

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุชุทุจูู SQL triggers
2. โ ุชูุนูู pg_net
3. โ ูุดุฑ Cloudflare Worker ุงููุญุฏุซ
4. โ ุชุนููู webhook_url
5. โ ุงุฎุชุจุงุฑ ุงููุธุงู

**ุจุนุฏ ุฐูู:**
- ุฑุงูุจ ุงูุฅุดุนุงุฑุงุช ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ
- ุชุญูู ูู ุงูู logs ูู Cloudflare
- ุนุฏู ูุตูุต ุงูุฅุดุนุงุฑุงุช ุญุณุจ ุงูุญุงุฌุฉ

---

## ๐ ุงููุณุงุนุฏุฉ

ุฅุฐุง ูู ุชุนูู ุงูุฅุดุนุงุฑุงุช:

1. **ุชุญูู ูู pg_net:**
   ```sql
   SELECT * FROM pg_available_extensions WHERE name = 'pg_net';
   ```

2. **ุชุญูู ูู webhook_url:**
   ```sql
   SELECT current_setting('app.settings.webhook_url', true);
   ```

3. **ุฑุงูุจ ุงูู logs:**
   - Supabase Logs
   - Cloudflare Worker Logs

4. **ุงุฎุชุจุฑ ุงูู Worker ูุจุงุดุฑุฉ:**
   ```bash
   curl -X POST https://your-worker.workers.dev \
     -H "Content-Type: application/json" \
     -d '{"type":"INSERT","table":"review_requests","record":{"product_name":"Test","requester_name":"User"}}'
   ```

---

## โ ุฌุงูุฒ!

ุงููุธุงู ุงูุขู ุฌุงูุฒ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ุนูุฏ ุฅุถุงูุฉ ุทูุจุงุช ุงูุชูููู ูุงูุชุนูููุงุช! ๐
