# ๐ ุฏููู ูุธุงู ุงููุดุงูุฏุงุช ููููุชุฌุงุช

## ๐ฏ **ูุง ุชู ุฅูุฌุงุฒู:**

ุชู ุชุทููุฑ ูุธุงู ูุดุงูุฏุงุช ูุชูุฏู ููููุชุฌุงุช ูุน **ุทุฑููุชูู ูุฎุชููุชูู** ูุญุณุงุจ ุงููุดุงูุฏุงุช ุญุณุจ ููุน ุงูุชุงุจ.

---

## ๐ **ุงููููุงุช ุงูููุดุฃุฉ ูุงููุนุฏูุฉ:**

### **1. SQL - ุฅุถุงูุฉ ุนููุฏ ุงููุดุงูุฏุงุช** ๐พ
๐ `supabase/add_views_to_products.sql`

**ุงููุญุชููุงุช:**
- โ ุฅุถุงูุฉ ุนููุฏ `views` ูุฌุฏูู `distributor_products`
- โ Index ูุชุญุณูู ุงูุฃุฏุงุก
- โ Function ูุฒูุงุฏุฉ ุงููุดุงูุฏุงุช `increment_product_views()`
- โ Constraint ููุชุฃูุฏ ูู ุงูููู ุงูููุฌุจุฉ

**ููููุฉ ุงูุชุทุจูู:**
```sql
-- 1. ุงูุชุญ Supabase Dashboard
-- 2. ุงุฐูุจ ุฅูู SQL Editor
-- 3. ุงูุตู ูุญุชููุงุช supabase/add_views_to_products.sql
-- 4. ุงุถุบุท Run
```

---

### **2. ProductModel - ุฅุถุงูุฉ ุญูู views** ๐
๐ `lib/features/products/domain/product_model.dart`

**ุงูุชุบููุฑุงุช:**
```dart
@HiveField(14)
final int views;  // ุนุฏุฏ ุงููุดุงูุฏุงุช

ProductModel({
  // ...
  this.views = 0,  // ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
});
```

---

### **3. ProductRepository - ุฏุงูุฉ incrementViews** ๐
๐ `lib/features/products/data/product_repository.dart`

**ุงูุฏุงูุฉ ุงููุถุงูุฉ:**
```dart
Future<void> incrementViews(String productId) async {
  try {
    await _supabase.rpc('increment_product_views', params: {
      'product_id': productId,
    });
  } catch (e) {
    print('ุฎุทุฃ ูู ุฒูุงุฏุฉ ูุดุงูุฏุงุช ุงูููุชุฌ: $e');
  }
}
```

---

### **4. ViewTrackingProductCard - ุชุชุจุน ุงููุดุงูุฏุงุช** ๐จ
๐ `lib/widgets/product_card.dart`

**Widget ุฌุฏูุฏ:**
```dart
class ViewTrackingProductCard extends ConsumerStatefulWidget {
  final bool trackViewOnVisible; // ุชูุนูู/ุชุนุทูู ุงูุชุชุจุน ุงูุชููุงุฆู
  // ...
}
```

**ุงูููุฒุงุช:**
- โ ุงุณุชุฎุฏุงู `VisibilityDetector` ูุฑุตุฏ ุธููุฑ ุงูููุชุฌ ุนูู ุงูุดุงุดุฉ
- โ ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏูุง ูููู ุงูููุชุฌ ุธุงูุฑ ุจูุณุจุฉ 50% ุฃู ุฃูุซุฑ
- โ ุชุชุจุน ุงูููุชุฌุงุช ุงูุชู ุชู ุญุณุงุจ ูุดุงูุฏุงุชูุง ูููุน ุงูุชูุฑุงุฑ
- โ Cache ุฐูู ุจุงุณุชุฎุฏุงู Set

---

### **5. ุชุญุฏูุซ ุงูุชุงุจุงุช** ๐

#### **ุฃ. Home Tab** 
๐ `lib/features/home/presentation/screens/home_screen.dart`

**ุงูุชุบููุฑ:**
```dart
ViewTrackingProductCard(
  product: product,
  productType: 'home',
  trackViewOnVisible: true, โ // ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏ ุงูุธููุฑ
  // ...
)
```

#### **ุจ. Expire Soon Tab**
๐ `lib/features/home/presentation/widgets/home_tabs_content.dart`

**ุงูุชุบููุฑ:**
```dart
ViewTrackingProductCard(
  product: item.product,
  productType: 'expire_soon',
  trackViewOnVisible: true, โ // ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏ ุงูุธููุฑ
  // ...
)
```

#### **ุฌ. Offers Tab**
๐ `lib/features/home/presentation/widgets/home_tabs_content.dart`

**ุงูุชุบููุฑ:**
```dart
ViewTrackingProductCard(
  product: item.product,
  productType: 'offers',
  trackViewOnVisible: true, โ // ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏ ุงูุธููุฑ
  // ...
)
```

#### **ุฏ. Surgical Tools Tab**
๐ `lib/features/home/presentation/widgets/home_tabs_content.dart`

**ุงูุชุบููุฑ 1 - ProductCard:**
```dart
ViewTrackingProductCard(
  product: tool,
  productType: 'surgical',
  trackViewOnVisible: false, โ // ูุง ูุญุณุจ ุนูุฏ ุงูุธููุฑ
  // ...
)
```

**ุงูุชุบููุฑ 2 - ุงูุฏูุงููุฌ:**
๐ `lib/features/home/presentation/widgets/product_dialogs.dart`

```dart
Future<void> showSurgicalToolDialog(
  BuildContext context,
  ProductModel tool,
) {
  // ุญุณุงุจ ุงููุดุงูุฏุฉ ููุฑ ูุชุญ ุงูุฏูุงููุฌ โ
  ProductRepository().incrementViews(tool.id);
  
  return showDialog(/* ... */);
}
```

---

## ๐ฏ **ููููุฉ ุนูู ุงููุธุงู:**

### **ุงูุทุฑููุฉ ุงูุฃููู: ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏ ุงูุธููุฑ** ๐๏ธ

**ุงููุณุชุฎุฏูุฉ ูู:** Home, Expire Soon, Offers

```
ุงููุณุชุฎุฏู ูุณูุฑูู ุงูุดุงุดุฉ
        โ
    ููุชุฌ ูุธูุฑ ุจูุณุจุฉ 50%+
        โ
    VisibilityDetector ููุชุดู ุงูุธููุฑ
        โ
    ูุชุญูู: ูู ุชู ุญุณุงุจู ูุจู ุฐููุ
   โ              โ
ูุนู              ูุง
 โ                โ
ุชุฌุงูู        โ increment_product_views()
              โ
           ุญูุธ ูู Cache
```

**ุงููุงุฆุฏุฉ:**
- โ ุงููุดุงูุฏุงุช ุชูุญุณุจ ุชููุงุฆูุงู ุนูุฏ ุธููุฑ ุงูููุชุฌ
- โ ูุง ูุญุชุงุฌ ุงููุณุชุฎุฏู ููุถุบุท ุนูู ุงูููุชุฌ
- โ ูุนูุณ ุงูุงูุชูุงู ุงููุนูู ุจุงูููุชุฌุงุช

---

### **ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุญุณุงุจ ุงููุดุงูุฏุฉ ุนูุฏ ูุชุญ ุงูุฏูุงููุฌ** ๐ฑ๏ธ

**ุงููุณุชุฎุฏูุฉ ูู:** Surgical Tools

```
ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุฃุฏุงุฉ ุฌุฑุงุญูุฉ
        โ
    ููุชุญ ุงูุฏูุงููุฌ
        โ
    ProductRepository.incrementViews()
        โ
    โ ุชูุญุณุจ ูุดุงูุฏุฉ
```

**ุงููุงุฆุฏุฉ:**
- โ ุงููุดุงูุฏุงุช ุชูุญุณุจ ููุท ุนูุฏ ุงูุงูุชูุงู ุงููุนูู (ูุชุญ ุงูุฏูุงููุฌ)
- โ ุฃูุซุฑ ุฏูุฉ ููููุชุฌุงุช ุงููููุฉ

---

## ๐ **ุงูููุงุฑูุฉ:**

| ุงูููุฒุฉ | Home/Expire/Offers | Surgical Tools |
|--------|-------------------|----------------|
| **ุงููุดุงูุฏุฉ ุชูุญุณุจ** | ุนูุฏ ุงูุธููุฑ ุนูู ุงูุดุงุดุฉ | ุนูุฏ ูุชุญ ุงูุฏูุงููุฌ |
| **ูุณุจุฉ ุงูุธููุฑ** | 50% ุฃู ุฃูุซุฑ | - |
| **ูุญุชุงุฌ ุถุบุทุฉ** | โ ูุง | โ ูุนู |
| **VisibilityDetector** | โ ููุนูู | โ ูุนุทูู |
| **ุงูุฏูุฉ** | ุงูุชูุงู ุนุงู | ุงูุชูุงู ูุนูู |

---

## ๐ **ุฎุทูุงุช ุงูุชุดุบูู:**

### **ุงูุฎุทูุฉ 1: ุชุทุจูู SQL** โ๏ธ **ุฅูุฒุงูู**
```bash
# 1. ุงูุชุญ Supabase Dashboard
# 2. SQL Editor โ New Query
# 3. ุงูุณุฎ ูุญุชูู: supabase/add_views_to_products.sql
# 4. ุงูุตู ูุงุถุบุท Run
```

### **ุงูุฎุทูุฉ 2: ุฅุนุงุฏุฉ ุชูููุฏ Hive Adapters** โ๏ธ **ุฅูุฒุงูู**
```bash
# ูู terminal
cd D:\fieldawy_store
flutter packages pub run build_runner build --delete-conflicting-outputs
```

**ููุงุญุธุฉ:** ูุฏ ูุณุชุบุฑู 2-3 ุฏูุงุฆู

### **ุงูุฎุทูุฉ 3: ุชุดุบูู ุงูุชุทุจูู**
```bash
flutter run
```

---

## ๐งช **ุงุฎุชุจุงุฑ ุงููุธุงู:**

### **ุงุฎุชุจุงุฑ 1: Home Tab**
```
1. ุงูุชุญ ุงูุชุทุจูู โ Home Tab
2. โ ุงุณูุฑูู ูุฃุณูู
3. โ ุดุงูุฏ 4 ููุชุฌุงุช ุชุธูุฑ
4. ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. โ ูุฌุจ ุฃู ุชุฑู views = 1 ููู ููุชุฌ ุธูุฑ
```

### **ุงุฎุชุจุงุฑ 2: Expire Soon Tab**
```
1. ุงุฐูุจ ูู Expire Soon Tab
2. โ ุงุณูุฑูู ูุงุนุฑุถ ุจุนุถ ุงูููุชุฌุงุช
3. โ ุงููุดุงูุฏุงุช ุชุฒูุฏ ุชููุงุฆูุงู
```

### **ุงุฎุชุจุงุฑ 3: Offers Tab**
```
1. ุงุฐูุจ ูู Offers Tab
2. โ ุงุณูุฑูู ูุงุนุฑุถ ุงูููุชุฌุงุช
3. โ ุงููุดุงูุฏุงุช ุชุฒูุฏ ุชููุงุฆูุงู
```

### **ุงุฎุชุจุงุฑ 4: Surgical Tools Tab**
```
1. ุงุฐูุจ ูู Surgical Tools Tab
2. โ ุงุณูุฑูู - ุงููุดุงูุฏุงุช ูุง ุชุฒูุฏ
3. โ ุงุถุบุท ุนูู ุฃุฏุงุฉ โ ููุชุญ ุงูุฏูุงููุฌ
4. โ ุงูุขู ุงููุดุงูุฏุฉ ุชูุญุณุจ
```

---

## ๐ **ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**

```sql
-- 1. ุนุฑุถ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุดุงูุฏุฉ
SELECT name, views 
FROM distributor_products 
ORDER BY views DESC 
LIMIT 10;

-- 2. ุนุฑุถ ุฅุฌูุงูู ุงููุดุงูุฏุงุช
SELECT SUM(views) as total_views 
FROM distributor_products;

-- 3. ูุชูุณุท ุงููุดุงูุฏุงุช
SELECT AVG(views) as avg_views 
FROM distributor_products;

-- 4. ุงูููุชุฌุงุช ุจุฏูู ูุดุงูุฏุงุช
SELECT COUNT(*) as zero_views 
FROM distributor_products 
WHERE views = 0;
```

---

## โก **ุงูุฃุฏุงุก:**

### **ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**
1. **Cache ุฐูู:** ูู ููุชุฌ ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููุท ูู ุงูุฌูุณุฉ
2. **Index ุนูู views:** ููุจุญุซ ุงูุณุฑูุน ูุงูุชุฑุชูุจ
3. **Function ูู SQL:** ุฃุณุฑุน ูู update ูุจุงุดุฑ
4. **VisibilityDetector:** ุฎููู ุฌุฏุงู ุนูู ุงูุฃุฏุงุก

### **ุงูุงุณุชููุงู:**
- **ุฐุงูุฑุฉ:** ~1-2 MB ููู Cache
- **ุดุจูุฉ:** ุทูุจ ูุงุญุฏ ููุท ููู ููุชุฌ
- **ูุนุงูุฌ:** ูุง ูุคุซุฑ ุนูู ุณูุงุณุฉ ุงูุชุทุจูู

---

## ๐ **ุญู ุงููุดุงูู:**

### **ูุดููุฉ 1: ุงููุดุงูุฏุงุช ูุง ุชุฒูุฏ**

**ุงูุณุจุจ ุงููุญุชูู:**
- โ SQL ูู ูุชู ุชุทุจููู

**ุงูุญู:**
```sql
-- ุชุญูู ูู ูุฌูุฏ ุนููุฏ views
SELECT column_name 
FROM information_schema.columns 
WHERE table_name = 'distributor_products' 
AND column_name = 'views';

-- ุฅุฐุง ูู ูุธูุฑุ ุทุจูู SQL script
```

---

### **ูุดููุฉ 2: Build Runner ููุดู**

**ุงูุณุจุจ ุงููุญุชูู:**
- โ conflict ูู Hive adapters

**ุงูุญู:**
```bash
# ุงุญุฐู ุงููููุงุช ุงููุฏููุฉ
flutter clean
flutter pub get

# ุซู ุดุบู build_runner
flutter packages pub run build_runner build --delete-conflicting-outputs
```

---

### **ูุดููุฉ 3: ุงููุดุงูุฏุงุช ุชูุญุณุจ ุฃูุซุฑ ูู ูุฑุฉ**

**ุงูุณุจุจ ุงููุญุชูู:**
- โ Cache ูุง ูุนูู

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู `_viewedProducts` Set ูุนูู ุจุดูู ุตุญูุญ
- ุฑุงุฌุน logs ูู Console

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

1. **Cache ูุญูู:**
   - ูููุณุญ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
   - ูุฐุง ุณููู ููุตูุฏ

2. **ูุณุจุฉ ุงูุธููุฑ:**
   - ุญุงููุงู: 50%
   - ูููู ุชุนุฏูููุง ูู `product_card.dart`

3. **ุงูุฃุฏูุงุช ุงูุฌุฑุงุญูุฉ:**
   - ุงููุดุงูุฏุฉ ุชูุญุณุจ **ููุท** ุนูุฏ ูุชุญ ุงูุฏูุงููุฌ
   - ุงูุธููุฑ ุนูู ุงูุดุงุดุฉ ูุง ูููู

4. **Realtime:**
   - ุงููุดุงูุฏุงุช ุชูุญุฏุซ ููุฑุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ูููู ุงุณุชุฎุฏุงู Supabase Realtime ููุนุฑุถ ุงููุจุงุดุฑ

---

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

โ **ูุธุงู ูุดุงูุฏุงุช ูุชูุฏู ูุฏููู**
โ **ุทุฑููุชูู ูุฎุชููุชูู ุญุณุจ ููุน ุงููุญุชูู**
โ **ุฃุฏุงุก ููุชุงุฒ ูุน cache ุฐูู**
โ **ุณูู ุงูุตูุงูุฉ ูุงูุชุทููุฑ**
โ **ุฅุญุตุงุฆูุงุช ุฏูููุฉ ููููุฏุฉ**

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ุงุจุฏุฃ ุงูุขู!**
