# ๐ฏ Top Products ุญุณุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช

## โ ุงูุชุญุฏูุซ ุงููุทุจู

ุชู ุชุญุฏูุซ `getTopProductsByViews()` ููุฑุชุจ ุงูููุชุฌุงุช ุญุณุจ **ุฅุฌูุงูู ุนุฏุฏ ุงููุดุงูุฏุงุช** (ูู ุงูุฃุนูู ููุฃูู).

---

## ๐ ุงูุชุบููุฑ

### ูุจู ุงูุชุญุฏูุซ:
```dart
// ูุงู ูุฌูุจ ููุท ุขุฎุฑ limit * 20 ูุดุงูุฏุฉ
final viewsResponse = await _supabase
    .from('product_views')
    .select('product_id, user_role, viewed_at')
    .order('viewed_at', ascending: false)
    .limit(limit * 20);  // โ ูุฐุง ูุฏ ููููุช ููุชุฌุงุช ุจูุดุงูุฏุงุช ูุฏููุฉ ูุซูุฑุฉ
```

**ุงููุดููุฉ:**
- ุฅุฐุง ููุชุฌ ุนูุฏู 500 ูุดุงูุฏุฉ ููู ูููุง ูุฏููุฉ
- ููู ููุชุฌ ุชุงูู ุนูุฏู 50 ูุดุงูุฏุฉ ุญุฏูุซุฉ
- ุงูููุฏ ุงููุฏูู ูุงู ูุนุฑุถ ุงูููุชุฌ ุงูุซุงูู (50 ูุดุงูุฏุฉ) ูุจู ุงูุฃูู (500 ูุดุงูุฏุฉ)

---

### ุจุนุฏ ุงูุชุญุฏูุซ:
```dart
// ูุฌูุจ ุขุฎุฑ 10,000 ูุดุงูุฏุฉ ูุญุณุงุจ ุงูุฅุฌูุงูู ุงูุตุญูุญ
final viewsResponse = await _supabase
    .from('product_views')
    .select('product_id, user_role, viewed_at')
    .limit(10000);  // โ ุฌูุจ ุนุฏุฏ ูุจูุฑ ูู ุงููุดุงูุฏุงุช

// ุญุณุงุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช ููู ููุชุฌ
Map<String, Map<String, dynamic>> productStats = {};
for (var view in viewsData) {
  productStats[productId]['total_views']++;  // ุนุฏู ูู ูุดุงูุฏุฉ
  if (view['user_role'] == 'doctor') {
    productStats[productId]['doctor_views']++;
  }
}

// ุชุฑุชูุจ ุญุณุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช (ุงูุฃุนูู ุฃููุงู)
var sortedProducts = productStats.entries.toList()
  ..sort((a, b) => b.value['total_views'].compareTo(a.value['total_views']));
```

**ุงูุญู:**
- โ ุฌูุจ ุขุฎุฑ 10,000 ูุดุงูุฏุฉ (ูุบุทู ูุนุธู ุงูุญุงูุงุช)
- โ ุญุณุงุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช ููู ููุชุฌ
- โ ุชุฑุชูุจ ุญุณุจ ุงูุฅุฌูุงูู ูู ุงูุฃุนูู ููุฃูู

---

## ๐ ููู ูุนูู ุงูุขู

### ูุซุงู:

#### ุงูุจูุงูุงุช ูู `product_views`:
```
Product A: 500 ูุดุงูุฏุฉ (300 ูููุง ูุฏููุฉุ 200 ุญุฏูุซุฉ)
Product B: 350 ูุดุงูุฏุฉ (ูููุง ุญุฏูุซุฉ)
Product C: 200 ูุดุงูุฏุฉ (ูููุง ูุฏููุฉ ุฌุฏุงู)
```

#### ุงููุชูุฌุฉ ูู Top Products:
```
1. Product A - 500 ูุดุงูุฏุฉ โญ (ุงูุฃุนูู)
2. Product B - 350 ูุดุงูุฏุฉ
3. Product C - 200 ูุดุงูุฏุฉ
```

**ุงูุชุฑุชูุจ ุญุณุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช ุจุบุถ ุงููุธุฑ ุนู ุงูุชุงุฑูุฎ** โ

---

## ๐ฏ ุงูููุฒุงุช

### 1. ุญุณุงุจ ุฏููู:
- โ ูุญุณุจ **ุฅุฌูุงูู** ุงููุดุงูุฏุงุช ููู ููุชุฌ
- โ ูุด ุจุณ ุขุฎุฑ ูุดุงูุฏุงุช

### 2. ุชุฑุชูุจ ุตุญูุญ:
- โ ุงูููุชุฌ ุงูุฃูุซุฑ ูุดุงูุฏุฉ ูุธูุฑ ุฃููุงู
- โ ุจุบุถ ุงููุธุฑ ุนู ุชุงุฑูุฎ ุงููุดุงูุฏุงุช

### 3. ูุนูููุงุช ุฅุถุงููุฉ:
- โ ุฅุฌูุงูู ุงููุดุงูุฏุงุช
- โ ูุดุงูุฏุงุช ุงูุฃุทุจุงุก
- โ ุขุฎุฑ ุชุงุฑูุฎ ูุดุงูุฏุฉ

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงูุฎุทูุงุช:

#### 1. ุฌูุจ ุงูุจูุงูุงุช:
```dart
// ุฌูุจ ุขุฎุฑ 10,000 ูุดุงูุฏุฉ
final viewsData = await supabase
    .from('product_views')
    .select('product_id, user_role, viewed_at')
    .limit(10000);
```

#### 2. ุงูุชุฌููุน:
```dart
Map<String, Map<String, dynamic>> productStats = {};
for (var view in viewsData) {
  if (!productStats.containsKey(productId)) {
    productStats[productId] = {
      'total_views': 0,
      'doctor_views': 0,
      'last_viewed_at': null,
    };
  }
  productStats[productId]['total_views']++;  // ุนุฏู ูู ูุดุงูุฏุฉ
}
```

#### 3. ุงูุชุฑุชูุจ:
```dart
// ุชุฑุชูุจ ุชูุงุฒูู ุญุณุจ total_views
var sortedProducts = productStats.entries.toList()
  ..sort((a, b) => b.value['total_views'].compareTo(a.value['total_views']));
```

#### 4. ุฃุฎุฐ Top N:
```dart
final topProductIds = sortedProducts.take(10).map((e) => e.key).toList();
```

#### 5. ุฌูุจ ุงูุชูุงุตูู:
```dart
final productsData = await supabase
    .from('products')
    .select('id, name, company, distributor_id')
    .inFilter('id', topProductIds);
```

#### 6. ุงููุชูุฌุฉ:
```dart
return results;  // ูุฑุชุจ ุญุณุจ ุงูุฃุนูู ูุดุงูุฏุงุช
```

---

## โก ุงูุฃุฏุงุก

### Limit 10,000:
- **ุณุฑูุน** ููุนุธู ุงูุชุทุจููุงุช
- **ุฏููู** ูุญุณุงุจ ุงูุฅุฌูุงูู
- **ูุงุจู ููุชุนุฏูู** ุฅุฐุง ุงุญุชุฌุช ุฃูุซุฑ

### ุฅุฐุง ูุงู ุนูุฏู ุฃูุซุฑ ูู 10,000 ูุดุงูุฏุฉ:
ููููู ุฒูุงุฏุฉ ุงูู limit:
```dart
.limit(50000);  // ุฃู ุฃูุซุฑ ุญุณุจ ุงูุญุงุฌุฉ
```

ุฃู ุงุณุชุฎุฏุงู SQL Views (ุฑุงุฌุน `CREATE_ANALYTICS_VIEWS.sql`).

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุดุบูู ุงูุชุทุจูู:
```bash
flutter run -d chrome
```

### 2. ุงูุชุญ Analytics โ Top Performers:
- ุชุงุจ **Top Products**

### 3. ุชุญูู ูู:
- โ ุงูููุชุฌ ุงูุฃุนูู ูุดุงูุฏุงุช ูู ุงูุฃูู
- โ ุงูุชุฑุชูุจ ุชูุงุฒูู ุญุณุจ ุนุฏุฏ ุงููุดุงูุฏุงุช
- โ ุงูุนุฏุฏ ุตุญูุญ ููู ููุชุฌ

---

## ๐ ูุซุงู ุงูุนุฑุถ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Top Products by Views                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Rank โ Product Name    โ Company โ Total Views โ Doctorsโ
โโโโโโโโผโโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโค
โ  1   โ Augmentin 1g    โ GSK     โ 1,250 โญ    โ 850    โ
โ  2   โ Panadol 500mg   โ GSK     โ 980         โ 620    โ
โ  3   โ Aspirin 100mg   โ Bayer   โ 750         โ 450    โ
โ  4   โ Amoxil 500mg    โ GSK     โ 520         โ 340    โ
โ  5   โ Brufen 400mg    โ Abbott  โ 410         โ 280    โ
โโโโโโโโดโโโโโโโโโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโโโโดโโโโโโโโโ
```

**ุงูุชุฑุชูุจ ูู ุงูุฃุนูู ููุฃูู ุญุณุจ Total Views** โ

---

## โ ุงูุฎูุงุตุฉ

### ูุจู:
- โ ุชุฑุชูุจ ุบูุฑ ุฏููู (ุญุณุจ ุขุฎุฑ ูุดุงูุฏุงุช ููุท)
- โ ูุฏ ููููุช ููุชุฌุงุช ุจูุดุงูุฏุงุช ูุฏููุฉ ูุซูุฑุฉ

### ุจุนุฏ:
- โ ุชุฑุชูุจ ุฏููู (ุญุณุจ ุฅุฌูุงูู ุงููุดุงูุฏุงุช)
- โ ุงูููุชุฌ ุงูุฃูุซุฑ ูุดุงูุฏุฉ ูุธูุฑ ุฃููุงู
- โ ูุญุณุจ ุฌููุน ุงููุดุงูุฏุงุช (ุญุชู ุงููุฏููุฉ)

---

**๐ ุงูุขู Top Products ูุนุฑุถ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุดุงูุฏุฉ ุจุดูู ุตุญูุญ! ๐**

```bash
flutter run -d chrome
```

**ุซู ุงุฎุชุจุฑ Analytics โ Top Performers โ Top Products**
