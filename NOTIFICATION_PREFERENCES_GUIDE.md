# ๐ ุฏููู ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช

## ๐ ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ

ุชู ุฅุถุงูุฉ ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช ุงูุชู ุชุณูุญ ูููุณุชุฎุฏููู ุจุงูุชุญูู ูู ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูุชู ูุฑูุฏูู ุงุณุชูุงููุง!

---

## โจ ุงููููุฒุงุช:

### 4 ุฃููุงุน ูู ุงูุฅุดุนุงุฑุงุช ูููู ุงูุชุญูู ูููุง:

1. **๐ฐ ุชุญุฏูุซุงุช ุงูุฃุณุนุงุฑ (Price Updates)**
   - ุฅุดุนุงุฑุงุช ุนูุฏ ุชุญุฏูุซ ุฃุณุนุงุฑ ุงูููุชุฌุงุช

2. **โ๏ธ ููุชุฌุงุช ูุงุฑุจุช ุนูู ุงูุงูุชูุงุก (Expiring Products)**
   - ุฅุดุนุงุฑุงุช ููููุชุฌุงุช ุงูุชู ุชูุชูู ุตูุงุญูุชูุง ุฎูุงู ุณูุฉ

3. **๐ ุงูุนุฑูุถ (Offers)**
   - ุฅุดุนุงุฑุงุช ุงูุนุฑูุถ ูุงูุฎุตููุงุช ุงูุฌุฏูุฏุฉ

4. **๐ง ุงูุฃุฏูุงุช ุงูุฌุฑุงุญูุฉ (Surgical Tools)**
   - ุฅุดุนุงุฑุงุช ุงูุฃุฏูุงุช ุงูุฌุฑุงุญูุฉ ุงูุฌุฏูุฏุฉ

---

## ๐ ููููุฉ ุงููุตูู ููุตูุญุฉ:

1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฐูุจ ุฅูู **ุงูุจุฑููุงูู** (Profile)
3. ุงุถุบุท ุนูู **ุงูุฅุดุนุงุฑุงุช** (Notifications)
4. ุณุชุธูุฑ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ูุน 4 Toggle Buttons

---

## ๐ง ุงูุฅุนุฏุงุฏ ุงูุฃููู:

### 1๏ธโฃ ุชุดุบูู Migration ูู Supabase:

```bash
# ุงูุทุฑููุฉ 1: ูู Dashboard
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู SQL Editor
3. ุงูุณุฎ ูุญุชูู ุงูููู: supabase/migrations/20250121_create_notification_preferences.sql
4. ูููุฐ ุงูู SQL
5. ุชุญูู ูู ุฅูุดุงุก ุงูุฌุฏูู ุจูุฌุงุญ

# ุงูุทุฑููุฉ 2: ูู CLI (ุฅุฐุง ูุงู ูุฏูู)
supabase db push
```

### 2๏ธโฃ ุงูุชุญูู ูู ุงูุฌุฏูู:

ูู Supabase Dashboard > Table Editorุ ูุฌุจ ุฃู ุชุดุงูุฏ ุฌุฏูู ุฌุฏูุฏ ุงุณูู:
```
notification_preferences
```

**ุงูุฃุนูุฏุฉ:**
- `id` - UUID
- `user_id` - UUID (ูุฑุชุจุท ุจู auth.users)
- `price_action` - BOOLEAN
- `expire_soon` - BOOLEAN
- `offers` - BOOLEAN
- `surgical_tools` - BOOLEAN
- `created_at` - TIMESTAMP
- `updated_at` - TIMESTAMP

### 3๏ธโฃ ุงูุชุญูู ูู RLS Policies:

ูุฌุจ ุฃู ุชุดุงูุฏ 4 policies:
- โ Users can view own notification preferences
- โ Users can insert own notification preferences
- โ Users can update own notification preferences
- โ Users can delete own notification preferences

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู:

### ูููุณุชุฎุฏู:

1. **ุงูุชุญ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช:**
   - Profile > Notifications

2. **ูุนูู ุฃู ุนุทูู ุฃู ููุน ูู ุงูุฅุดุนุงุฑุงุช:**
   - Toggle ON โ = ุณุฃุณุชูุจู ูุฐู ุงูุฅุดุนุงุฑุงุช
   - Toggle OFF โ = ูู ุฃุณุชูุจู ูุฐู ุงูุฅุดุนุงุฑุงุช

3. **ุงูุชุบููุฑุงุช ุชูุญูุธ ุชููุงุฆูุงู:**
   - ูุง ุชุญุชุงุฌ ูุฒุฑ "ุญูุธ"
   - ุณุชุฑู ุฑุณุงูุฉ "ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช" ุนูุฏ ูู ุชุบููุฑ

---

## ๐งช ุงูุงุฎุชุจุงุฑ:

### Test 1: ุชุนุทูู ุฅุดุนุงุฑุงุช ุงูุฃุณุนุงุฑ

```sql
-- 1. ุนุทูู ุฅุดุนุงุฑุงุช Price Action ูู ุงูุตูุญุฉ
-- 2. ุญุฏูุซ ุณุนุฑ ููุชุฌ
UPDATE distributor_products
SET price = price + 1
WHERE id = (SELECT id FROM distributor_products LIMIT 1);

-- ุงููุชูุฌุฉ: ูู ูุธูุฑ ุฅุดุนุงุฑ โ
```

### Test 2: ุชุนุทูู ุฅุดุนุงุฑุงุช ุงูุนุฑูุถ

```sql
-- 1. ุนุทูู ุฅุดุนุงุฑุงุช Offers ูู ุงูุตูุญุฉ
-- 2. ุฃุถู ุนุฑุถ ุฌุฏูุฏ
INSERT INTO offers (...)

-- ุงููุชูุฌุฉ: ูู ูุธูุฑ ุฅุดุนุงุฑ โ
```

### Test 3: ุชูุนูู ูู ุงูุฅุดุนุงุฑุงุช

```
-- 1. ูุนูู ุฌููุน ุงูู Toggles
-- 2. ุงุฎุชุจุฑ ุฃู ุฅุดุนุงุฑ

-- ุงููุชูุฌุฉ: ุณุชุธูุฑ ุฌููุน ุงูุฅุดุนุงุฑุงุช โ
```

---

## ๐ฏ ููู ุชุนูู ุงูููุชุฑุฉ:

### ูู Flutter (main.dart):

```dart
// ูุจู ุนุฑุถ ุฃู ุฅุดุนุงุฑ:
if (!await _shouldShowNotification(screen)) {
  print('โญ๏ธ ุชู ุชุฎุทู ุงูุฅุดุนุงุฑ (ูุนุทูู ูู ุงูุฅุนุฏุงุฏุงุช)');
  return;
}

// ููุญุต:
Future<bool> _shouldShowNotification(String screen) async {
  // ูุญุฏุฏ ููุน ุงูุฅุดุนุงุฑ ูู screen name
  // ูุฌูุจ ุงูุชูุถููุงุช ูู Supabase
  // ูุฑุฌุน true/false
}
```

### ูู Supabase:

```sql
-- ุงูุจูุงูุงุช ูุญููุธุฉ ููู ูุณุชุฎุฏู:
SELECT * FROM notification_preferences WHERE user_id = 'user_id';

-- ุงููุชูุฌุฉ:
{
  "price_action": true,
  "expire_soon": false,  -- ูุนุทูู
  "offers": true,
  "surgical_tools": true
}
```

---

## ๐ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ:

ุนูุฏ ุฃูู ุงุณุชุฎุฏุงูุ **ุฌููุน ุงูุฅุดุนุงุฑุงุช ููุนููุฉ**:
- โ Price Action = ููุนูู
- โ Expire Soon = ููุนูู
- โ Offers = ููุนูู
- โ Surgical Tools = ููุนูู

ุงููุณุชุฎุฏู ููููู ุชุนุฏูููุง ุญุณุจ ุฑุบุจุชู.

---

## ๐ ุงูุฃูุงู (RLS):

- โ ูู ูุณุชุฎุฏู ูุฑู ุฅุนุฏุงุฏุงุชู ููุท
- โ ูุง ูููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ูุณุชุฎุฏููู ุขุฎุฑูู
- โ ุชูุญุฐู ุงูุฅุนุฏุงุฏุงุช ุชููุงุฆูุงู ุนูุฏ ุญุฐู ุงููุณุชุฎุฏู (ON DELETE CASCADE)

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช

**ุงูุญู:**
```bash
# 1. ุชุฃูุฏ ูู flutter clean
flutter clean
flutter pub get

# 2. ุฃุนุฏ build ุงูุชุทุจูู
flutter run
```

### ุงููุดููุฉ: ุฎุทุฃ ูู ุญูุธ ุงูุฅุนุฏุงุฏุงุช

**ุงูุญู:**
1. ุชุญูู ูู RLS Policies ูู Supabase
2. ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู
3. ุงูุญุต Console logs ูู Supabase Dashboard

### ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ุฑุบู ุงูุชุนุทูู

**ุงูุญู:**
1. ุงูุญุต Logs ูู ุงูุชุทุจูู (Console)
2. ุชุฃูุฏ ูู ูุฌูุฏ ุงูุณุทุฑ: `โญ๏ธ ุชู ุชุฎุทู ุงูุฅุดุนุงุฑ`
3. ุฅุฐุง ูู ูุธูุฑุ ุชุญูู ูู:
   - `notification_preferences` table ููุฌูุฏ
   - ุงูุจูุงูุงุช ูุญููุธุฉ ูู ุงูุฌุฏูู
   - RLS policies ุตุญูุญุฉ

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ:

1. **Flutter:**
   - `lib/features/notifications/notification_preferences_screen.dart`
   - `lib/services/notification_preferences_service.dart`
   - ุชุนุฏูู `lib/main.dart` (ุฅุถุงูุฉ ููุชุฑุฉ)
   - ุชุนุฏูู `lib/features/profile/presentation/screens/profile_screen.dart`

2. **Supabase:**
   - `supabase/migrations/20250121_create_notification_preferences.sql`

3. **Translations:**
   - ุชุญุฏูุซ `assets/translations/ar.json`
   - ุชุญุฏูุซ `assets/translations/en.json`

---

## โ ุงูุฎูุงุตุฉ:

1. โ Migration ุฌุงูุฒ ูู Supabase
2. โ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุฌุงูุฒุฉ
3. โ ุงูููุชุฑุฉ ุชุนูู ูู ุงูุฎูููุฉ ูุงูููุฏูุฉ
4. โ ุงูุชุฑุฌูุงุช ุฌุงูุฒุฉ (ุนุฑุจู ูุฅูุฌููุฒู)
5. โ RLS Policies ูุญููุฉ

**ุงูุขู ูููู ูููุณุชุฎุฏููู ุงูุชุญูู ุงููุงูู ูู ุฅุดุนุงุฑุงุชูู! ๐**
