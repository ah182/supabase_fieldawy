# ๐บ๏ธ ุชุญุฏูุซ ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูููุดุงูุฏุงุช

## โ ูุง ุชู ุชุญุฏูุซู:

### **1. dashboard_repository.dart**
- โ ุชู ุฅุตูุงุญ `user['uid']` ุฅูู `user['id']` (ุงูุณุทุฑ 571)
- โ ุงูุขู ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงููุนููุฉ ูู `product_views`

### **2. analytics_repository.dart**
- โ ุชู ุงุณุชุจุฏุงู ุงูุจูุงูุงุช ุงูููููุฉ (Mock Data)
- โ ุงูุขู ูุณุชุฎุฏู ุงูุจูุงูุงุช ุงููุนููุฉ ูู `product_views`
- โ ูุฌูุน ุงููุดุงูุฏุงุช ูู ุฌููุน ุฃููุงุน ุงูููุชุฌุงุช:
  - distributor_products
  - distributor_ocr_products
  - distributor_surgical_tools

---

## ๐ฏ ููู ูุนูู ุงูุขู:

### **ุงูุฎุทูุงุช:**
1. ูุฌูุน ุฌููุน product_ids ููููุฒุน
2. ูุจุญุซ ูู `product_views` ุนู ุงููุดุงูุฏุงุช ููุฐู ุงูููุชุฌุงุช
3. ูุญุตู ุนูู user_ids ุงูุฐูู ุดุงูุฏูุง ุงูููุชุฌุงุช
4. ูุฌูุจ governorates ูู ุฌุฏูู `users`
5. ูุญุณุจ ุนุฏุฏ ุงููุดุงูุฏุงุช ููู ูุญุงูุธุฉ
6. ูุฑุชุจ ุงููุชุงุฆุฌ ุญุณุจ ุงูุฃูุซุฑ ูุดุงูุฏุฉ

---

## ๐ ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ:

### **ูุจู:**
```dart
// ุจูุงูุงุช ููููุฉ
{'region': 'ุงููุงูุฑุฉ', 'views': 125, 'percentage': 0.35}
{'region': 'ุงูุฌูุฒุฉ', 'views': 89, 'percentage': 0.25}
```

### **ุจุนุฏ:**
```dart
// ุจูุงูุงุช ูุนููุฉ ูู product_views
{'region': 'ุงููุงูุฑุฉ', 'views': 45, 'percentage': 0.42}  // ุญุณุจ ุงููุดุงูุฏุงุช ุงููุนููุฉ
{'region': 'ุงูุฅุณููุฏุฑูุฉ', 'views': 32, 'percentage': 0.30}
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ:

### **1. ุฃุถู ุจูุงูุงุช ุงุฎุชุจุงุฑ:**
```sql
-- ูู Supabase SQL Editor
SELECT track_product_view('443', 'regular');
SELECT track_product_view('1129', 'regular');
SELECT track_product_view('443', 'regular');
```

### **2. ุชุญูู ูู ุงูุจูุงูุงุช:**
```sql
SELECT 
  pv.product_id,
  u.governorates,
  COUNT(*) as views
FROM product_views pv
JOIN users u ON pv.user_id = u.id
WHERE u.governorates IS NOT NULL
GROUP BY pv.product_id, u.governorates;
```

### **3. ูู ุงูุชุทุจูู:**
1. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู
```bash
flutter run
```

2. ุงุฐูุจ ุฅูู Dashboard
3. ุงุจุญุซ ุนู ูุณู "ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูููุดุงูุฏุงุช"
4. ูุฌุจ ุฃู ุชุฑู ุงูุจูุงูุงุช ุงููุนููุฉ!

---

## ๐ ูุซุงู ุนูู ุงููุชูุฌุฉ:

### **ูู ุงูุฏุงุด ุจูุฑุฏ:**
```
ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูููุดุงูุฏุงุช
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงููุงูุฑุฉ        โโโโโโโโโโโโโโโโ 45 (42%)
ุงูุฅุณููุฏุฑูุฉ    โโโโโโโโโโโโ     32 (30%)
ุงูุฌูุฒุฉ         โโโโโโโโ         20 (19%)
ุงูุฏููููุฉ       โโโโ             10 (9%)
```

---

## ๐ ุงุณุชุนูุงูุงุช ูููุฏุฉ:

### **ุนุฑุถ ุงูุชูุฒูุน ุงูุฌุบุฑุงูู:**
```sql
SELECT 
  jsonb_array_elements_text(u.governorates) as governorate,
  COUNT(*) as views,
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
FROM product_views pv
JOIN users u ON pv.user_id = u.id
WHERE u.governorates IS NOT NULL
GROUP BY governorate
ORDER BY views DESC;
```

### **ุงูุชูุฒูุน ูููุฒุน ูุนูู:**
```sql
SELECT 
  jsonb_array_elements_text(u.governorates) as governorate,
  COUNT(*) as views
FROM product_views pv
JOIN users u ON pv.user_id = u.id
WHERE pv.product_id IN (
  SELECT product_id 
  FROM distributor_products 
  WHERE distributor_id = 'YOUR_USER_ID'
)
AND u.governorates IS NOT NULL
GROUP BY governorate
ORDER BY views DESC;
```

### **ุฃูุซุฑ 5 ูุญุงูุธุงุช ูุดุงูุฏุฉ:**
```sql
SELECT 
  jsonb_array_elements_text(u.governorates) as governorate,
  COUNT(*) as views
FROM product_views pv
JOIN users u ON pv.user_id = u.id
WHERE u.governorates IS NOT NULL
GROUP BY governorate
ORDER BY views DESC
LIMIT 5;
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู:

- [x] ุชู ุชุญุฏูุซ `dashboard_repository.dart`
- [x] ุชู ุชุญุฏูุซ `analytics_repository.dart`
- [x] ุชู ุฅุตูุงุญ `uid` ุฅูู `id`
- [ ] ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
- [ ] ุงูุจูุงูุงุช ุงููุนููุฉ ุชุธูุฑ ูู ุงูุฏุงุด ุจูุฑุฏ
- [ ] ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ุฏููู

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

ุงูุขู:
- โ ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ูุนุฑุถ ุจูุงูุงุช ูุนููุฉ 100%
- โ ูุชู ุญุณุงุจ ุงููุดุงูุฏุงุช ูู `product_views`
- โ ูุชู ุฑุจุท ุงููุดุงูุฏุงุช ุจูุญุงูุธุงุช ุงููุณุชุฎุฏููู
- โ ุงููุณุจ ุงููุฆููุฉ ุฏูููุฉ
- โ ุงูุชุฑุชูุจ ุญุณุจ ุงูุฃูุซุฑ ูุดุงูุฏุฉ

---

## ๐ ููุงุญุธุงุช:

1. **ุฅุฐุง ูู ุชุธูุฑ ุจูุงูุงุช:**
   - ุชุฃูุฏ ูู ูุฌูุฏ ูุดุงูุฏุงุช ูู `product_views`
   - ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏููู ูุฏููู `governorates`
   - ุชุญูู ูู ุฃู `product_id` ููุฌูุฏ ูู ุฌุฏุงูู ุงูููุชุฌุงุช

2. **ูุชุญุณูู ุงูุฃุฏุงุก:**
   - ูููู ุฅุถุงูุฉ Cache ูููุชุงุฆุฌ
   - ูููู ุชุญุฏูุฏ ูุชุฑุฉ ุฒูููุฉ (ุขุฎุฑ 30 ููู ูุซูุงู)

3. **ููุชุทููุฑ ุงููุณุชูุจูู:**
   - ุฅุถุงูุฉ ููุชุฑ ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ
   - ุฅุถุงูุฉ ููุชุฑ ุญุณุจ ููุน ุงูููุชุฌ
   - ุฅุถุงูุฉ ุฎุฑูุทุฉ ุชูุงุนููุฉ

