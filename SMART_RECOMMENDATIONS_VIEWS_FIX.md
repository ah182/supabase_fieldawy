# ๐ง ุฅุตูุงุญ ุฎุทุฃ views ูู ุงูุชูุตูุงุช ุงูุฐููุฉ

## โ ุงููุดููุฉ:

```
Error: column products.views does not exist
```

**ุงูุณุจุจ:** ุฌุฏูู `products` ูุง ูุญุชูู ุนูู ุนููุฏ `views`

---

## โ ุงูุญู:

ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู `products.views`ุ ูุญุณุจ ุงูุฅุญุตุงุฆูุงุช ูู `distributor_products`:

1. **ุงููุดุงูุฏุงุช ุงูุนุงูููุฉ:** ูุฌููุน `views` ูู ุฌููุน ุงูููุฒุนูู
2. **ุนุฏุฏ ุงูููุฒุนูู:** ุนุฏุฏ ุงูููุฒุนูู ุงูุฐูู ูุจูุนูู ุงูููุชุฌ
3. **Score ููุชุฑุชูุจ:** `(views ร 2) + (distributors ร 100)`

---

## ๐ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ:

### **1. ุฌูุจ ุฌููุน ุงูููุชุฌุงุช:**
```dart
final allProducts = await _supabase
    .from('products')
    .select('id, name, company')  // โ ุจุฏูู views
    .limit(200);
```

### **2. ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ููู ููุชุฌ:**
```dart
for (var product in allProducts) {
  // ุฌูุจ ุจูุงูุงุช ุงูููุฒุนูู ููุฐุง ุงูููุชุฌ
  final distributorData = await _supabase
      .from('distributor_products')
      .select('views')
      .eq('product_id', productId);
  
  // ุนุฏุฏ ุงูููุฒุนูู
  distributorCount = distributorData.length;
  
  // ูุฌููุน ุงููุดุงูุฏุงุช ูู ุฌููุน ุงูููุฒุนูู
  for (var dist in distributorData) {
    globalViews += dist['views'] ?? 0;
  }
  
  // ุญุณุงุจ Score ููุชุฑุชูุจ
  score = (globalViews ร 2) + (distributorCount ร 100);
}
```

### **3. ุงูุชุฑุชูุจ ุญุณุจ ุงูู Score:**
```dart
productStats.sort((a, b) => b['score'].compareTo(a['score']));

return productStats.take(10).toList();
```

---

## ๐ฏ ูุนุงุฏูุฉ ุงูู Score:

```
Score = (Global Views ร 2) + (Distributor Count ร 100)
```

### **ููุงุฐุง ูุฐู ุงููุนุงุฏูุฉุ**

- **Distributor Count ร 100:** ูุฒู ุฃูุจุฑ ูุนุฏุฏ ุงูููุฒุนูู
  - ุฅุฐุง ูุงู 50 ููุฒุน ูุจูุนูู ุงูููุชุฌ = 5,000 ููุทุฉ
  - ูุนูู ุงูููุชุฌ ุฑุงุฆุฌ ููุทููุจ

- **Global Views ร 2:** ูุฒู ุฃูู ูููุดุงูุฏุงุช
  - 1,000 ูุดุงูุฏุฉ = 2,000 ููุทุฉ
  - ูุนูู ุงูููุชุฌ ูุดููุฑ

### **ูุซุงู:**

```
ุงูููุชุฌ A:
- 30 ููุฒุน
- 500 ูุดุงูุฏุฉ
- Score = (500 ร 2) + (30 ร 100) = 1,000 + 3,000 = 4,000

ุงูููุชุฌ B:
- 10 ููุฒุนูู
- 2,000 ูุดุงูุฏุฉ
- Score = (2,000 ร 2) + (10 ร 100) = 4,000 + 1,000 = 5,000

ุงููุชูุฌุฉ: ุงูููุชุฌ B ุฃุนูู (ุฑุบู ุฃู A ูุฏูู ููุฒุนูู ุฃูุซุฑ)
```

---

## ๐ ุงูููุงุฑูุฉ:

### **ูุจู (ุฎุทุฃ):**
```dart
// โ ูุญุงูู ุฌูุจ views ูู products
final topProducts = await _supabase
    .from('products')
    .select('id, name, company, views')  // โ views ูุง ููุฌุฏ
    .order('views', ascending: false);

// Error: column products.views does not exist
```

### **ุจุนุฏ (ุตุญูุญ):**
```dart
// โ ูุฌูุจ ุงูููุชุฌุงุช ุจุฏูู views
final allProducts = await _supabase
    .from('products')
    .select('id, name, company')  // โ ุจุฏูู views
    .limit(200);

// โ ูุญุณุจ views ูู distributor_products
final distributorData = await _supabase
    .from('distributor_products')
    .select('views')
    .eq('product_id', productId);

// โ ูุฌูุน ุงููุดุงูุฏุงุช
for (var dist in distributorData) {
  globalViews += dist['views'] ?? 0;
}
```

---

## ๐จ ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ:

### **ููู ููุชุฌ:**
```dart
{
  'id': '123',
  'name': 'Amoxicillin 500mg',
  'company': 'Pfizer',
  'global_views': 1250,        // โ ูุฌููุน ูู ุฌููุน ุงูููุฒุนูู
  'distributor_count': 45,     // โ ุนุฏุฏ ุงูููุฒุนูู
  'score': 6750                // โ ููุชุฑุชูุจ ููุท (ูุง ููุนุฑุถ)
}
```

---

## ๐ฑ ุงูุดูู ุงูููุงุฆู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ก ุชูุตูุงุช ุฐููุฉ              [ููุฎุตุต ูู]       โ
โ ููุชุฌุงุช ุฑุงุฆุฌุฉ ุนุงูููุงู - ุฃุถููุง ููุชุงููุฌู         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                โ
โ #1  Amoxicillin 500mg          [ุฃุถู]          โ
โ     ๐ 1,250 ูุดุงูุฏุฉ ุนุงูููุงู  ๐ช 45 ููุฒุน      โ
โ     Score: 6,750 (ูุฎูู)                       โ
โ                                                โ
โ #2  Paracetamol 500mg          [ุฃุถู]          โ
โ     ๐ 980 ูุดุงูุฏุฉ ุนุงูููุงู   ๐ช 38 ููุฒุน       โ
โ     Score: 5,760 (ูุฎูู)                       โ
โ                                                โ
โ #3  Ibuprofen 400mg            [ุฃุถู]          โ
โ     ๐ 850 ูุดุงูุฏุฉ ุนุงูููุงู   ๐ช 32 ููุฒุน       โ
โ     Score: 4,900 (ูุฎูู)                       โ
โ                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงูุชุตููุฉ:

### **ูุชู ุนุฑุถ ุงูููุชุฌ ููุท ุฅุฐุง:**
```dart
if (distributorCount > 0 || globalViews > 0) {
  // โ ุงูููุชุฌ ูู ูุดุงุท
  productStats.add(product);
}
```

**ููุงุฐุงุ**
- ูุง ูุฑูุฏ ุนุฑุถ ููุชุฌุงุช ูุง ุฃุญุฏ ูุจูุนูุง
- ูุง ูุฑูุฏ ุนุฑุถ ููุชุฌุงุช ุจุฏูู ูุดุงูุฏุงุช
- ูุฑูุฏ ููุท ููุชุฌุงุช "ุฑุงุฆุฌุฉ" ูุนูุงู

---

## ๐งช ุงูุงุฎุชุจุงุฑ:

```bash
flutter run
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก
- โ ุงูุชูุตูุงุช ุชุธูุฑ
- โ ุงูููุชุฌุงุช ูุฑุชุจุฉ ุญุณุจ ุงูุดุนุจูุฉ
- โ ุงููุดุงูุฏุงุช ูุนุฏุฏ ุงูููุฒุนูู ุตุญูุญุฉ

---

## ๐ Logs:

```
Distributor has 15 product IDs and 23 product names
Error getting product stats for Product X: ...  (ุฅุฐุง ุญุฏุซ ุฎุทุฃ)
Found 7 recommendations
```

---

## โก ุงูุฃุฏุงุก:

### **ุงููุดููุฉ ุงููุญุชููุฉ:**
- ุฌูุจ 200 ููุชุฌ
- ููู ููุชุฌุ query ูููุตู ูู distributor_products
- ูุฏ ูููู ุจุทูุฆุงู

### **ุงูุญู ุงููุณุชูุจูู:**
```sql
-- ุงุณุชุฎุฏุงู SQL View ุฃู Function
CREATE VIEW global_product_stats AS
SELECT 
  p.id,
  p.name,
  p.company,
  COUNT(dp.id) as distributor_count,
  SUM(dp.views) as global_views
FROM products p
LEFT JOIN distributor_products dp ON p.id = dp.product_id
GROUP BY p.id, p.name, p.company;
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู:

- [x] ุชู ุฅุฒุงูุฉ ุงูุงุนุชูุงุฏ ุนูู products.views
- [x] ุชู ุญุณุงุจ global_views ูู distributor_products
- [x] ุชู ุญุณุงุจ distributor_count
- [x] ุชู ุฅุถุงูุฉ score ููุชุฑุชูุจ
- [x] ุชู ุงูุชุตููุฉ (ููุท ููุชุฌุงุช ุจูุดุงุท)
- [x] ุชู ุงูุชุฑุชูุจ ุญุณุจ score
- [x] ุชู ุฅุฑุฌุงุน ุฃูุถู 10
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุชุทุจูู
- [ ] ุงูุชูุตูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ

---

## ๐ ุงููุชูุฌุฉ:

ุงูุขู ุงูุชูุตูุงุช ุงูุฐููุฉ:
- โ ุชุนูู ุจุฏูู ุฃุฎุทุงุก
- โ ุชุญุณุจ ุงูุฅุญุตุงุฆูุงุช ูู distributor_products
- โ ุชุฑุชุจ ุงูููุชุฌุงุช ุญุณุจ ุงูุดุนุจูุฉ ุงูุญููููุฉ
- โ ุชุนุฑุถ ููุท ููุชุฌุงุช ุฑุงุฆุฌุฉ ูุนูุงู
- โ ุฏูููุฉ ูููุซููุฉ

---

## ๐ก ููุงุญุธุฉ:

**Global Views** ุงูุขู ุชุนูู:
- ูุฌููุน ุงููุดุงูุฏุงุช ูู **ุฌููุน ุงูููุฒุนูู**
- ูููุณ ูุดุงูุฏุงุช ูู ุฌุฏูู products
- ุฃูุซุฑ ุฏูุฉ ูุฃููุง ุชุนูุณ ุงูุงูุชูุงู ุงููุนูู

