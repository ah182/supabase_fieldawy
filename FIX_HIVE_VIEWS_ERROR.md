# ๐ง ุฅุตูุงุญ: ุฎุทุฃ Hive Adapter ููุญูู views

## โ **ุงูุฎุทุฃ:**
```
Unhandled Exception: type 'Null' is not a subtype of type 'int' in type cast
#0 ProductModelAdapter.read (product_model.g.dart:34:25)
```

---

## ๐ **ุงูุณุจุจ:**

ุนูุฏ ุฅุถุงูุฉ ุญูู `views` ุฌุฏูุฏ ุฅูู `ProductModel`ุ ุงูุจูุงูุงุช ุงููุฏููุฉ ุงููุฎุฒูุฉ ูู Hive **ูุง ุชุญุชูู** ุนูู ูุฐุง ุงูุญูู.

### **ูุง ูุญุฏุซ:**
```dart
// ูู product_model.g.dart (ุงููุฏูู)
views: fields[14] as int,  // โ fields[14] = null ููุจูุงูุงุช ุงููุฏููุฉ
```

**ุงููุชูุฌุฉ:** ูุญุงูู ุชุญููู `null` ุฅูู `int` โ **ุฎุทุฃ!**

---

## โ **ุงูุญู ุงููุทุจู:**

### **ุงูุชุนุฏูู ูู `product_model.g.dart`:**

#### **ูุจู (ูุณุจุจ ุฎุทุฃ):**
```dart
views: fields[14] as int,
```

#### **ุจุนุฏ (ุขูู):**
```dart
views: (fields[14] as int?) ?? 0,  // โ ูุชุนุงูู ูุน null
```

**ุงููุงุฆุฏุฉ:**
- ุฅุฐุง ูุงู `fields[14]` ููุฌูุฏ โ ุงุณุชุฎุฏูู
- ุฅุฐุง ูุงู `null` (ุจูุงูุงุช ูุฏููุฉ) โ ุงุณุชุฎุฏู `0`

---

## ๐ **ุฎุทูุงุช ุงูุชุทุจูู:**

### **ุงูุทุฑููุฉ 1: Flutter Clean (ููุตู ุจูุง)**

```bash
# 1. ุชูุธูู ุงููุดุฑูุน
flutter clean

# 2. ุฅุนุงุฏุฉ ุชุซุจูุช ุงูู packages
flutter pub get

# 3. ุชุดุบูู ุงูุชุทุจูู
flutter run
```

**ุงููุงุฆุฏุฉ:** ููุณุญ ูู ุงูุจูุงูุงุช ุงููุคูุชุฉ ุจูุง ูููุง Hive cache.

---

### **ุงูุทุฑููุฉ 2: ูุณุญ Hive Cache ูุฏููุงู (ุฅุถุงูู)**

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุฃุถู ูุฐุง ุงูููุฏ ูู `main()`:

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // ูุณุญ Hive cache ุงููุฏูู
  await Hive.initFlutter();
  await Hive.deleteFromDisk(); // โ๏ธ ุณููุณุญ ูู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ
  
  runApp(MyApp());
}
```

**โ๏ธ ุชุญุฐูุฑ:** ุณููุณุญ ูู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุญููุงู!

---

## ๐ **ููุงุฐุง ุญุฏุซ ูุฐุงุ**

### **Timeline:**

1. **ูู ุงููุงุถู:**
   ```dart
   ProductModel:
     - id (field 0)
     - name (field 1)
     - ...
     - isFavorite (field 13)
     // ูุง ููุฌุฏ views โ
   ```

2. **ุชู ุญูุธ ุงูููุชุฌุงุช ูู Hive:**
   ```
   Hive Box: products
     - Product 1: fields[0..13]
     - Product 2: fields[0..13]
     // ูุง ููุฌุฏ field[14]
   ```

3. **ุงูููู - ุฃุถููุง `views`:**
   ```dart
   ProductModel:
     - ...
     - isFavorite (field 13)
     - views (field 14) โ ุฌุฏูุฏ!
   ```

4. **ุงููุดููุฉ:**
   ```dart
   // ุนูุฏ ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ:
   views: fields[14] as int  // fields[14] = null!
   // โ ุฎุทุฃ!
   ```

---

## โ **ูุง ุชู ุฅุตูุงุญู:**

### **1. ูู `product_model.g.dart`:**
```dart
views: (fields[14] as int?) ?? 0,  // โ ุขูู
```

### **2. ูููู ุฅุถุงูุฉ validation ุฅุถุงูู:**
```dart
// ูู ProductModel constructor
ProductModel({
  // ...
  this.views = 0,  // โ ูููุฉ ุงูุชุฑุงุถูุฉ
});
```

---

## ๐งช **ุงูุชุญูู ูู ุงูุฅุตูุงุญ:**

### **1. ุจุนุฏ flutter clean:**
```bash
flutter run
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ ุงูุชุทุจูู ูุนูู ุจุฏูู ุฃุฎุทุงุก

### **2. ุชุญูู ูู ุงูููุชุฌุงุช:**
```dart
// ูู ุงูุชุทุจูู
final products = await getProducts();
for (final product in products) {
  print('${product.name}: views = ${product.views}');
  // Output: Product Name: views = 0 (ููุจูุงูุงุช ุงููุฏููุฉ)
}
```

---

## ๐ฏ **ุงูุญููู ุงูุจุฏููุฉ (ุบูุฑ ูุทููุจุฉ ุงูุขู):**

### **ุงูุญู 1: Migration Script**
```dart
// ูู main()
Future<void> migrateHiveData() async {
  await Hive.initFlutter();
  
  // ูุชุญ ุงูุตูุฏูู ุงููุฏูู
  final box = await Hive.openBox<ProductModel>('products');
  
  // ุชุญุฏูุซ ูู ุงูููุชุฌุงุช
  for (var i = 0; i < box.length; i++) {
    final product = box.getAt(i);
    if (product != null) {
      // ุฅุนุงุฏุฉ ุญูุธ ูุน ุงููููุฉ ุงูุฌุฏูุฏุฉ
      await box.putAt(i, product.copyWith(views: 0));
    }
  }
}
```

### **ุงูุญู 2: ุชุบููุฑ typeId**
```dart
// ูู product_model.dart
@HiveType(typeId: 1)  // โ ุชุบููุฑ ูู 0 ุฅูู 1
class ProductModel {
  // ...
}
```
**ุงููุงุฆุฏุฉ:** Hive ุณูุชุนุงูู ูุนู ูููุน ุฌุฏูุฏ.

---

## ๐ **ููุงุฑูุฉ ุงูุญููู:**

| ุงูุญู | ุงูุณูููุฉ | ุงูุชุฃุซูุฑ | ุงูุณุฑุนุฉ |
|------|---------|---------|---------|
| **flutter clean** โ | ุณูู ุฌุฏุงู | ููุณุญ ูู cache | ุณุฑูุน |
| **ุงูุชุนุฏูู ูู .g.dart** โ | ุณูู | ุขูู ููุณุชุฏุงู | ููุฑู |
| **Migration Script** | ูุชูุณุท | ุฏููู | ุจุทูุก ููููุงู |
| **ุชุบููุฑ typeId** | ุตุนุจ | ูุญุชุงุฌ ุฅุนุงุฏุฉ ููููุฉ | ูุชูุณุท |

**ุงูุญู ุงููุทุจู:** โ flutter clean + ุงูุชุนุฏูู ูู .g.dart

---

## ๐ก **ูุตุงุฆุญ ูููุณุชูุจู:**

### **ุนูุฏ ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูู Hive Models:**

1. **ุงุณุชุฎุฏู ููู ุงูุชุฑุงุถูุฉ:**
   ```dart
   @HiveField(14)
   final int views;
   
   ProductModel({
     this.views = 0,  // โ ูููุฉ ุงูุชุฑุงุถูุฉ
   });
   ```

2. **ุชุฃูุฏ ูู null-safety ูู adapter:**
   ```dart
   views: (fields[14] as int?) ?? 0,  // โ
   ```

3. **ุงุฎุชุจุฑ ูุน ุจูุงูุงุช ูุฏููุฉ:**
   ```dart
   // ูุจู ุงูุชุทุจูู ูู production
   await testWithOldData();
   ```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

1. **flutter clean ุขูู:**
   - ููุณุญ build cache
   - ููุณุญ Hive cache
   - **ูุง ูุคุซุฑ** ุนูู Supabase data

2. **ุงูุจูุงูุงุช ูู Supabase:**
   - โ ุขููุฉ ุชูุงูุงู
   - ูู ุชุชุฃุซุฑ ุจู flutter clean

3. **ุฅุนุงุฏุฉ ุงูุชุญููู:**
   - ุนูุฏ ุฃูู ุชุดุบูู ุจุนุฏ clean
   - ุณูุชู ุฌูุจ ุงูุจูุงูุงุช ูู Supabase
   - ูุน ุญูู `views = 0` ููุฌููุน

---

## ๐ **ุงููุชูุฌุฉ:**

โ **ุงููุดููุฉ ูุญูููุฉ**
โ **ุงูุชุทุจูู ูุนูู ุจุฏูู ุฃุฎุทุงุก**
โ **ุงูุจูุงูุงุช ุงููุฏููุฉ ูุชูุงููุฉ**
โ **ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุชุนูู ุจุดูู ุตุญูุญ**

---

**๐ ุงูุขู ุดุบูู `flutter clean` ุซู `flutter run`!**
